var I={Stringify:1,BeforeStream:2,Stream:3},b=(e,t)=>{const s=new String(e);return s.isEscaped=!0,s.callbacks=t,s},Ie=/[&<>'"]/,we=async e=>{let t="";const s=[];for(let r=e.length-1;t+=e[r],r--,!(r<0);r--){let n=await e[r];typeof n=="object"&&s.push(...n.callbacks||[]);const a=n.isEscaped;if(n=await(typeof n=="object"?n.toString():n),typeof n=="object"&&s.push(...n.callbacks||[]),n.isEscaped??a)t+=n;else{const o=[t];H(n,o),t=o[0]}}return b(t,s)},H=(e,t)=>{const s=e.search(Ie);if(s===-1){t[0]+=e;return}let r,n,a=0;for(n=s;n<e.length;n++){switch(e.charCodeAt(n)){case 34:r="&quot;";break;case 39:r="&#39;";break;case 38:r="&amp;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}t[0]+=e.substring(a,n)+r,a=n+1}t[0]+=e.substring(a,n)},Z=async(e,t,s,r,n)=>{const a=e.callbacks;if(!(a!=null&&a.length))return Promise.resolve(e);n?n[0]+=e:n=[e];const o=Promise.all(a.map(h=>h({phase:t,buffer:n,context:r}))).then(h=>Promise.all(h.filter(Boolean).map(i=>Z(i,t,!1,r,n))).then(()=>n[0]));return s?b(await o,a):o},je=(e,...t)=>{const s=[""];for(let r=0,n=e.length-1;r<n;r++){s[0]+=e[r];const a=t[r]instanceof Array?t[r].flat(1/0):[t[r]];for(let o=0,h=a.length;o<h;o++){const i=a[o];if(typeof i=="string")H(i,s);else{if(typeof i=="boolean"||i===null||i===void 0)continue;if(typeof i=="object"&&i.isEscaped||typeof i=="number"){const c=i.toString();c instanceof Promise?s.unshift("",c):s[0]+=c}else i instanceof Promise?s.unshift("",i):H(i.toString(),s)}}}return s[0]+=e[e.length-1],s.length===1?b(s[0]):we(s)},We=Symbol("RENDERER"),qe=Symbol("ERROR_HANDLER"),Ee=e=>{e&&"className"in e&&(e.class=e.className,delete e.className)},Ue=(e,t,s)=>{typeof e=="string"&&Ee(t);let r;return t&&"children"in t?(r=t.children,delete t.children):r=[],{tag:e,props:t,key:s,children:Array.isArray(r)?r:[r]}},ze=e=>Ue("",e,void 0),Ge=e=>({value:t,children:s})=>{const r=ze({children:[{tag:()=>{e.push(t)}},...s,{tag:()=>{e.pop()}}]});return r[qe]=n=>{throw e.pop(),n},r},ae=[],Ke=e=>{const t=[e],s={values:t,Provider(r){t.push(r.value);let n;try{n=r.children?(Array.isArray(r.children)?new Re("",{},r.children):r.children).toString():""}finally{t.pop()}return n instanceof Promise?n.then(a=>b(a,a.callbacks)):b(n)}};return s.Provider[We]=Ge(t),ae.push(s),s},Ve=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],Xe=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],le=(e,t)=>{for(let s=0,r=e.length;s<r;s++){const n=e[s];if(typeof n=="string")H(n,t);else{if(typeof n=="boolean"||n===null||n===void 0)continue;n instanceof B?n.toStringToBuffer(t):typeof n=="number"||n.isEscaped?t[0]+=n:n instanceof Promise?t.unshift("",n):le(n,t)}}},B=class{constructor(e,t,s){this.isEscaped=!0,this.tag=e,this.props=t,this.children=s}toString(){var t,s;const e=[""];(t=this.localContexts)==null||t.forEach(([r,n])=>{r.values.push(n)});try{this.toStringToBuffer(e)}finally{(s=this.localContexts)==null||s.forEach(([r])=>{r.values.pop()})}return e.length===1?e[0]:we(e)}toStringToBuffer(e){const t=this.tag,s=this.props;let{children:r}=this;e[0]+=`<${t}`;const n=Object.keys(s||{});for(let a=0,o=n.length;a<o;a++){const h=n[a],i=s[h];if(h==="style"&&typeof i=="object"){const c=Object.keys(i).map(l=>`${l.replace(/[A-Z]/g,f=>`-${f.toLowerCase()}`)}:${i[l]}`).join(";");e[0]+=` style="${c}"`}else if(typeof i=="string")e[0]+=` ${h}="`,H(i,e),e[0]+='"';else if(i!=null)if(typeof i=="number"||i.isEscaped)e[0]+=` ${h}="${i}"`;else if(typeof i=="boolean"&&Xe.includes(h))i&&(e[0]+=` ${h}=""`);else if(h==="dangerouslySetInnerHTML"){if(r.length>0)throw"Can only set one of `children` or `props.dangerouslySetInnerHTML`.";r=[b(i.__html)]}else if(i instanceof Promise)e[0]+=` ${h}="`,e.unshift('"',i);else if(typeof i=="function"){if(!h.startsWith("on"))throw`Invalid prop '${h}' of type 'function' supplied to '${t}'.`}else e[0]+=` ${h}="`,H(i.toString(),e),e[0]+='"'}if(Ve.includes(t)){e[0]+="/>";return}e[0]+=">",le(r,e),e[0]+=`</${t}>`}},Je=class extends B{toStringToBuffer(e){const{children:t}=this,s=this.tag.call(null,{...this.props,children:t.length<=1?t[0]:t});if(s instanceof Promise)if(ae.length===0)e.unshift("",s);else{const r=ae.map(n=>[n,n.values.at(-1)]);e.unshift("",s.then(n=>(n instanceof B&&(n.localContexts=r),n)))}else s instanceof B?s.toStringToBuffer(e):typeof s=="number"||s.isEscaped?e[0]+=s:H(s,e)}},Re=class extends B{toStringToBuffer(e){le(this.children,e)}},Qe=(e,t,...s)=>{let r;t&&(r=t==null?void 0:t.key,delete t.key);const n=Q(e,t,s);return n.key=r,n},Q=(e,t,s)=>typeof e=="function"?new Je(e,t,s):(Ee(t),new B(e,t,s)),Ye=({children:e})=>new Re("",{},Array.isArray(e)?e:e?[e]:[]);function D(e,t,s){let r;if(!t||!("children"in t))r=Q(e,t,[]);else{const n=t.children;delete t.children,r=Array.isArray(n)?Q(e,t,n):Q(e,t,[n])}return r.key=s,r}var xe=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},u=(e,t,s)=>(xe(e,t,"read from private field"),s?s.call(e):t.get(e)),F=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},m=(e,t,s,r)=>(xe(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),Ze="text/plain; charset=UTF-8",se=(e,t={})=>(Object.entries(t).forEach(([s,r])=>e.set(s,r)),e),j,T,v,p,x,$,Y=class{constructor(e,t){this.env={},this._var={},this.finalized=!1,this.error=void 0,F(this,j,200),F(this,T,void 0),F(this,v,void 0),F(this,p,void 0),F(this,x,void 0),F(this,$,!0),this.layout=void 0,this.renderer=s=>this.html(s),this.notFoundHandler=()=>new Response,this.render=(...s)=>this.renderer(...s),this.setLayout=s=>this.layout=s,this.getLayout=()=>this.layout,this.setRenderer=s=>{this.renderer=s},this.header=(s,r,n)=>{if(r===void 0){u(this,v)?u(this,v).delete(s):u(this,p)&&delete u(this,p)[s.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(s);return}n!=null&&n.append?(u(this,v)||(m(this,$,!1),m(this,v,new Headers(u(this,p))),m(this,p,{})),u(this,v).append(s,r)):u(this,v)?u(this,v).set(s,r):(u(this,p)??m(this,p,{}),u(this,p)[s.toLowerCase()]=r),this.finalized&&(n!=null&&n.append?this.res.headers.append(s,r):this.res.headers.set(s,r))},this.status=s=>{m(this,$,!1),m(this,j,s)},this.set=(s,r)=>{this._var??(this._var={}),this._var[s]=r},this.get=s=>this._var?this._var[s]:void 0,this.newResponse=(s,r,n)=>{if(u(this,$)&&!n&&!r&&u(this,j)===200)return new Response(s,{headers:u(this,p)});if(r&&typeof r!="number"){const o=se(new Headers(r.headers),u(this,p));return new Response(s,{headers:o,status:r.status})}const a=typeof r=="number"?r:u(this,j);u(this,p)??m(this,p,{}),u(this,v)??m(this,v,new Headers),se(u(this,v),u(this,p)),u(this,x)&&(u(this,x).headers.forEach((o,h)=>{var i;(i=u(this,v))==null||i.set(h,o)}),se(u(this,v),u(this,p))),n??(n={});for(const[o,h]of Object.entries(n))if(typeof h=="string")u(this,v).set(o,h);else{u(this,v).delete(o);for(const i of h)u(this,v).append(o,i)}return new Response(s,{status:a,headers:u(this,v)})},this.body=(s,r,n)=>typeof r=="number"?this.newResponse(s,r,n):this.newResponse(s,r),this.text=(s,r,n)=>{if(!u(this,p)){if(u(this,$)&&!n&&!r)return new Response(s);m(this,p,{})}return u(this,p)["content-type"]=Ze,typeof r=="number"?this.newResponse(s,r,n):this.newResponse(s,r)},this.json=(s,r,n)=>{const a=JSON.stringify(s);return u(this,p)??m(this,p,{}),u(this,p)["content-type"]="application/json; charset=UTF-8",typeof r=="number"?this.newResponse(a,r,n):this.newResponse(a,r)},this.html=(s,r,n)=>(u(this,p)??m(this,p,{}),u(this,p)["content-type"]="text/html; charset=UTF-8",typeof s=="object"&&(s instanceof Promise||(s=s.toString()),s instanceof Promise)?s.then(a=>Z(a,I.Stringify,!1,{})).then(a=>typeof r=="number"?this.newResponse(a,r,n):this.newResponse(a,r)):typeof r=="number"?this.newResponse(s,r,n):this.newResponse(s,r)),this.redirect=(s,r=302)=>(u(this,v)??m(this,v,new Headers),u(this,v).set("Location",s),this.newResponse(null,r)),this.notFound=()=>this.notFoundHandler(this),this.req=e,t&&(m(this,T,t.executionCtx),this.env=t.env,t.notFoundHandler&&(this.notFoundHandler=t.notFoundHandler))}get event(){if(u(this,T)&&"respondWith"in u(this,T))return u(this,T);throw Error("This context has no FetchEvent")}get executionCtx(){if(u(this,T))return u(this,T);throw Error("This context has no ExecutionContext")}get res(){return m(this,$,!1),u(this,x)||m(this,x,new Response("404 Not Found",{status:404}))}set res(e){if(m(this,$,!1),u(this,x)&&e){u(this,x).headers.delete("content-type");for(const[t,s]of u(this,x).headers.entries())if(t==="set-cookie"){const r=u(this,x).headers.getSetCookie();e.headers.delete("set-cookie");for(const n of r)e.headers.append("set-cookie",n)}else e.headers.set(t,s)}m(this,x,e),this.finalized=!0}get var(){return{...this._var}}};j=new WeakMap;T=new WeakMap;v=new WeakMap;p=new WeakMap;x=new WeakMap;$=new WeakMap;var fe=(e,t,s)=>(r,n)=>{let a=-1;return o(0);async function o(h){if(h<=a)throw new Error("next() called multiple times");a=h;let i,c=!1,l;if(e[h]?(l=e[h][0][0],r instanceof Y&&(r.req.routeIndex=h)):l=h===e.length&&n||void 0,!l)r instanceof Y&&r.finalized===!1&&s&&(i=await s(r));else try{i=await l(r,()=>o(h+1))}catch(d){if(d instanceof Error&&r instanceof Y&&t)r.error=d,i=await t(d,r),c=!0;else throw d}return i&&(r.finalized===!1||c)&&(r.res=i),r}},et=class extends Error{constructor(e=500,t){super(t==null?void 0:t.message),this.res=t==null?void 0:t.res,this.status=e}getResponse(){return this.res?this.res:new Response(this.message,{status:this.status})}},tt=async(e,t={all:!1})=>{const r=(e instanceof Te?e.raw.headers:e.headers).get("Content-Type");return rt(r)?st(e,t):{}};function rt(e){return e===null?!1:e.startsWith("multipart/form-data")||e.startsWith("application/x-www-form-urlencoded")}async function st(e,t){const s=await e.formData();return s?nt(s,t):{}}function nt(e,t){const s={};return e.forEach((r,n)=>{t.all||n.endsWith("[]")?it(s,n,r):s[n]=r}),s}var it=(e,t,s)=>{e[t]&&at(e[t])?ot(e[t],s):e[t]?ht(e,t,s):e[t]=s};function at(e){return Array.isArray(e)}var ot=(e,t)=>{e.push(t)},ht=(e,t,s)=>{e[t]=[e[t],s]},Se=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},ct=e=>{const{groups:t,path:s}=lt(e),r=Se(s);return dt(r,t)},lt=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(s,r)=>{const n=`@${r}`;return t.push([n,s]),n}),{groups:t,path:e}},dt=(e,t)=>{for(let s=t.length-1;s>=0;s--){const[r]=t[s];for(let n=e.length-1;n>=0;n--)if(e[n].includes(r)){e[n]=e[n].replace(r,t[s][1]);break}}return e},V={},pe=e=>{if(e==="*")return"*";const t=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);return t?(V[e]||(t[2]?V[e]=[e,t[1],new RegExp("^"+t[2]+"$")]:V[e]=[e,t[1],!0]),V[e]):null},_e=e=>{const t=e.url.match(/^https?:\/\/[^/]+(\/[^?]*)/);return t?t[1]:""},ut=e=>{const t=e.indexOf("?",8);return t===-1?"":"?"+e.slice(t+1)},ft=e=>{const t=_e(e);return t.length>1&&t[t.length-1]==="/"?t.slice(0,-1):t},N=(...e)=>{let t="",s=!1;for(let r of e)t[t.length-1]==="/"&&(t=t.slice(0,-1),s=!0),r[0]!=="/"&&(r=`/${r}`),r==="/"&&s?t=`${t}/`:r!=="/"&&(t=`${t}${r}`),r==="/"&&t===""&&(t="/");return t},Pe=e=>{if(!e.match(/\:.+\?$/))return null;const t=e.split("/"),s=[];let r="";return t.forEach(n=>{if(n!==""&&!/\:/.test(n))r+="/"+n;else if(/\:/.test(n))if(/\?/.test(n)){s.length===0&&r===""?s.push("/"):s.push(r);const a=n.replace("?","");r+="/"+a,s.push(r)}else r+="/"+n}),s.filter((n,a,o)=>o.indexOf(n)===a)},ne=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),/%/.test(e)?oe(e):e):e,ke=(e,t,s)=>{let r;if(!s&&t&&!/[%+]/.test(t)){let o=e.indexOf(`?${t}`,8);for(o===-1&&(o=e.indexOf(`&${t}`,8));o!==-1;){const h=e.charCodeAt(o+t.length+1);if(h===61){const i=o+t.length+2,c=e.indexOf("&",i);return ne(e.slice(i,c===-1?void 0:c))}else if(h==38||isNaN(h))return"";o=e.indexOf(`&${t}`,o+1)}if(r=/[%+]/.test(e),!r)return}const n={};r??(r=/[%+]/.test(e));let a=e.indexOf("?",8);for(;a!==-1;){const o=e.indexOf("&",a+1);let h=e.indexOf("=",a);h>o&&o!==-1&&(h=-1);let i=e.slice(a+1,h===-1?o===-1?void 0:o:h);if(r&&(i=ne(i)),a=o,i==="")continue;let c;h===-1?c="":(c=e.slice(h+1,o===-1?void 0:o),r&&(c=ne(c))),s?(n[i]&&Array.isArray(n[i])||(n[i]=[]),n[i].push(c)):n[i]??(n[i]=c)}return t?n[t]:n},pt=ke,yt=(e,t)=>ke(e,t,!0),oe=decodeURIComponent,Ae=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},A=(e,t,s)=>(Ae(e,t,"read from private field"),s?s.call(e):t.get(e)),ye=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},ve=(e,t,s,r)=>(Ae(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),W,_,Te=class{constructor(e,t="/",s=[[]]){ye(this,W,void 0),ye(this,_,void 0),this.routeIndex=0,this.bodyCache={},this.cachedBody=r=>{const{bodyCache:n,raw:a}=this,o=n[r];return o||(n.arrayBuffer?(async()=>await new Response(n.arrayBuffer)[r]())():n[r]=a[r]())},this.raw=e,this.path=t,ve(this,_,s),ve(this,W,{})}param(e){return e?this.getDecodedParam(e):this.getAllDecodedParams()}getDecodedParam(e){const t=A(this,_)[0][this.routeIndex][1][e],s=this.getParamValue(t);return s?/\%/.test(s)?oe(s):s:void 0}getAllDecodedParams(){const e={},t=Object.keys(A(this,_)[0][this.routeIndex][1]);for(const s of t){const r=this.getParamValue(A(this,_)[0][this.routeIndex][1][s]);r&&typeof r=="string"&&(e[s]=/\%/.test(r)?oe(r):r)}return e}getParamValue(e){return A(this,_)[1]?A(this,_)[1][e]:e}query(e){return pt(this.url,e)}queries(e){return yt(this.url,e)}header(e){if(e)return this.raw.headers.get(e.toLowerCase())??void 0;const t={};return this.raw.headers.forEach((s,r)=>{t[r]=s}),t}async parseBody(e){if(this.bodyCache.parsedBody)return this.bodyCache.parsedBody;const t=await tt(this,e);return this.bodyCache.parsedBody=t,t}json(){return this.cachedBody("json")}text(){return this.cachedBody("text")}arrayBuffer(){return this.cachedBody("arrayBuffer")}blob(){return this.cachedBody("blob")}formData(){return this.cachedBody("formData")}addValidatedData(e,t){A(this,W)[e]=t}valid(e){return A(this,W)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return A(this,_)[0].map(([[,e]])=>e)}get routePath(){return A(this,_)[0].map(([[,e]])=>e)[this.routeIndex].path}};W=new WeakMap;_=new WeakMap;var g="ALL",vt="all",$e=["get","post","put","delete","options","patch"],Ce="Can not add a route since the matcher is already built.",be=class extends Error{},He=(e,t,s)=>{if(!t.has(e))throw TypeError("Cannot "+s)},X=(e,t,s)=>(He(e,t,"read from private field"),s?s.call(e):t.get(e)),gt=(e,t,s)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,s)},J=(e,t,s,r)=>(He(e,t,"write to private field"),r?r.call(e,s):t.set(e,s),s),mt=Symbol("composedHandler");function wt(){return class{}}var Et=e=>e.text("404 Not Found",404),ge=(e,t)=>e instanceof et?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),P,Oe=class extends wt(){constructor(e={}){super(),this._basePath="/",gt(this,P,"/"),this.routes=[],this.notFoundHandler=Et,this.errorHandler=ge,this.onError=r=>(this.errorHandler=r,this),this.notFound=r=>(this.notFoundHandler=r,this),this.fetch=(r,n,a)=>this.dispatch(r,a,n,r.method),this.request=(r,n,a,o)=>{if(r instanceof Request)return n!==void 0&&(r=new Request(r,n)),this.fetch(r,a,o);r=r.toString();const h=/^https?:\/\//.test(r)?r:`http://localhost${N("/",r)}`,i=new Request(h,n);return this.fetch(i,a,o)},this.fire=()=>{addEventListener("fetch",r=>{r.respondWith(this.dispatch(r.request,r,void 0,r.request.method))})},[...$e,vt].map(r=>{this[r]=(n,...a)=>(typeof n=="string"?J(this,P,n):this.addRoute(r,X(this,P),n),a.map(o=>{typeof o!="string"&&this.addRoute(r,X(this,P),o)}),this)}),this.on=(r,n,...a)=>{if(!r)return this;for(const o of[n].flat()){J(this,P,o);for(const h of[r].flat())a.map(i=>{this.addRoute(h.toUpperCase(),X(this,P),i)})}return this},this.use=(r,...n)=>(typeof r=="string"?J(this,P,r):(J(this,P,"*"),n.unshift(r)),n.map(a=>{this.addRoute(g,X(this,P),a)}),this);const s=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=s?e.getPath??_e:ft}clone(){const e=new Oe({router:this.router,getPath:this.getPath});return e.routes=this.routes,e}route(e,t){const s=this.basePath(e);return t?(t.routes.map(r=>{let n;t.errorHandler===ge?n=r.handler:(n=async(a,o)=>(await fe([],t.errorHandler)(a,()=>r.handler(a,o))).res,n[mt]=r.handler),s.addRoute(r.method,r.path,n)}),this):s}basePath(e){const t=this.clone();return t._basePath=N(this._basePath,e),t}mount(e,t,s){const r=N(this._basePath,e),n=r==="/"?0:r.length,a=async(o,h)=>{let i;try{i=o.executionCtx}catch{}const c=s?s(o):[o.env,i],l=Array.isArray(c)?c:[c],d=ut(o.req.url),f=await t(new Request(new URL((o.req.path.slice(n)||"/")+d,o.req.url),o.req.raw),...l);if(f)return f;await h()};return this.addRoute(g,N(e,"*"),a),this}addRoute(e,t,s){e=e.toUpperCase(),t=N(this._basePath,t);const r={path:t,method:e,handler:s};this.router.add(e,t,[s,r]),this.routes.push(r)}matchRoute(e,t){return this.router.match(e,t)}handleError(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e}dispatch(e,t,s,r){if(r==="HEAD")return(async()=>new Response(null,await this.dispatch(e,t,s,"GET")))();const n=this.getPath(e,{env:s}),a=this.matchRoute(r,n),o=new Y(new Te(e,n,a),{env:s,executionCtx:t,notFoundHandler:this.notFoundHandler});if(a[0].length===1){let i;try{if(i=a[0][0][0][0](o,async()=>{}),!i)return this.notFoundHandler(o)}catch(c){return this.handleError(c,o)}return i instanceof Promise?i.then(c=>c||(o.finalized?o.res:this.notFoundHandler(o))).catch(c=>this.handleError(c,o)):i}const h=fe(a[0],this.errorHandler,this.notFoundHandler);return(async()=>{try{const i=await h(o);if(!i.finalized)throw new Error("Context is not finalized. You may forget returning Response object or `await next()`");return i.res}catch(i){return this.handleError(i,o)}})()}},Rt=Oe;P=new WeakMap;var ee="[^/]+",U=".*",z="(?:|/.*)",q=Symbol();function xt(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===U||e===z?1:t===U||t===z?-1:e===ee?1:t===ee?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var he=class{constructor(){this.children={}}insert(t,s,r,n,a){if(t.length===0){if(this.index!==void 0)throw q;if(a)return;this.index=s;return}const[o,...h]=t,i=o==="*"?h.length===0?["","",U]:["","",ee]:o==="/*"?["","",z]:o.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let c;if(i){const l=i[1];let d=i[2]||ee;if(l&&i[2]&&(d=d.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(d)))throw q;if(c=this.children[d],!c){if(Object.keys(this.children).some(f=>f!==U&&f!==z))throw q;if(a)return;c=this.children[d]=new he,l!==""&&(c.varIndex=n.varIndex++)}!a&&l!==""&&r.push([l,c.varIndex])}else if(c=this.children[o],!c){if(Object.keys(this.children).some(l=>l.length>1&&l!==U&&l!==z))throw q;if(a)return;c=this.children[o]=new he}c.insert(h,s,r,n,a)}buildRegExpStr(){const s=Object.keys(this.children).sort(xt).map(r=>{const n=this.children[r];return(typeof n.varIndex=="number"?`(${r})@${n.varIndex}`:r)+n.buildRegExpStr()});return typeof this.index=="number"&&s.unshift(`#${this.index}`),s.length===0?"":s.length===1?s[0]:"(?:"+s.join("|")+")"}},St=class{constructor(){this.context={varIndex:0},this.root=new he}insert(e,t,s){const r=[],n=[];for(let o=0;;){let h=!1;if(e=e.replace(/\{[^}]+\}/g,i=>{const c=`@\\${o}`;return n[o]=[c,i],o++,h=!0,c}),!h)break}const a=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let o=n.length-1;o>=0;o--){const[h]=n[o];for(let i=a.length-1;i>=0;i--)if(a[i].indexOf(h)!==-1){a[i]=a[i].replace(h,n[o][1]);break}}return this.root.insert(a,t,r,this.context,s),r}buildRegExp(){let e=this.root.buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const s=[],r=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(n,a,o)=>typeof a<"u"?(s[++t]=Number(a),"$()"):(typeof o<"u"&&(r[Number(o)]=++t),"")),[new RegExp(`^${e}`),s,r]}},ie=[g,...$e].map(e=>e.toUpperCase()),Fe=[],_t=[/^$/,[],{}],ce={};function Le(e){return ce[e]??(ce[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*/,"(?:|/.*)")}$`))}function Pt(){ce={}}function kt(e){var c;const t=new St,s=[];if(e.length===0)return _t;const r=e.map(l=>[!/\*|\/:/.test(l[0]),...l]).sort(([l,d],[f,w])=>l?1:f?-1:d.length-w.length),n={};for(let l=0,d=-1,f=r.length;l<f;l++){const[w,y,E]=r[l];w?n[y]=[E.map(([S])=>[S,{}]),Fe]:d++;let R;try{R=t.insert(y,d,w)}catch(S){throw S===q?new be(y):S}w||(s[d]=E.map(([S,C])=>{const k={};for(C-=1;C>=0;C--){const[G,K]=R[C];k[G]=K}return[S,k]}))}const[a,o,h]=t.buildRegExp();for(let l=0,d=s.length;l<d;l++)for(let f=0,w=s[l].length;f<w;f++){const y=(c=s[l][f])==null?void 0:c[1];if(!y)continue;const E=Object.keys(y);for(let R=0,S=E.length;R<S;R++)y[E[R]]=h[y[E[R]]]}const i=[];for(const l in o)i[l]=s[o[l]];return[a,i,n]}function L(e,t){if(e){for(const s of Object.keys(e).sort((r,n)=>n.length-r.length))if(Le(s).test(t))return[...e[s]]}}var At=class{constructor(){this.name="RegExpRouter",this.middleware={[g]:{}},this.routes={[g]:{}}}add(e,t,s){var r;const{middleware:n,routes:a}=this;if(!n||!a)throw new Error(Ce);ie.indexOf(e)===-1&&ie.push(e),n[e]||[n,a].forEach(i=>{i[e]={},Object.keys(i[g]).forEach(c=>{i[e][c]=[...i[g][c]]})}),t==="/*"&&(t="*");const o=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const i=Le(t);e===g?Object.keys(n).forEach(c=>{var l;(l=n[c])[t]||(l[t]=L(n[c],t)||L(n[g],t)||[])}):(r=n[e])[t]||(r[t]=L(n[e],t)||L(n[g],t)||[]),Object.keys(n).forEach(c=>{(e===g||e===c)&&Object.keys(n[c]).forEach(l=>{i.test(l)&&n[c][l].push([s,o])})}),Object.keys(a).forEach(c=>{(e===g||e===c)&&Object.keys(a[c]).forEach(l=>i.test(l)&&a[c][l].push([s,o]))});return}const h=Pe(t)||[t];for(let i=0,c=h.length;i<c;i++){const l=h[i];Object.keys(a).forEach(d=>{var f;(e===g||e===d)&&((f=a[d])[l]||(f[l]=[...L(n[d],l)||L(n[g],l)||[]]),a[d][l].push([s,o-c+i+1]))})}}match(e,t){Pt();const s=this.buildAllMatchers();return this.match=(r,n)=>{const a=s[r],o=a[2][n];if(o)return o;const h=n.match(a[0]);if(!h)return[[],Fe];const i=h.indexOf("",1);return[a[1][i],h]},this.match(e,t)}buildAllMatchers(){const e={};return ie.forEach(t=>{e[t]=this.buildMatcher(t)||e[g]}),this.middleware=this.routes=void 0,e}buildMatcher(e){const t=[];let s=e===g;return[this.middleware,this.routes].forEach(r=>{const n=r[e]?Object.keys(r[e]).map(a=>[a,r[e][a]]):[];n.length!==0?(s||(s=!0),t.push(...n)):e!==g&&t.push(...Object.keys(r[g]).map(a=>[a,r[g][a]]))}),s?kt(t):null}},Tt=class{constructor(e){this.name="SmartRouter",this.routers=[],this.routes=[],Object.assign(this,e)}add(e,t,s){if(!this.routes)throw new Error(Ce);this.routes.push([e,t,s])}match(e,t){if(!this.routes)throw new Error("Fatal error");const{routers:s,routes:r}=this,n=s.length;let a=0,o;for(;a<n;a++){const h=s[a];try{r.forEach(i=>{h.add(...i)}),o=h.match(e,t)}catch(i){if(i instanceof be)continue;throw i}this.match=h.match.bind(h),this.routers=[h],this.routes=void 0;break}if(a===n)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,o}get activeRouter(){if(this.routes||this.routers.length!==1)throw new Error("No active router has been determined yet.");return this.routers[0]}},De=class{constructor(e,t,s){if(this.order=0,this.params={},this.children=s||{},this.methods=[],this.name="",e&&t){const r={};r[e]={handler:t,possibleKeys:[],score:0,name:this.name},this.methods=[r]}this.patterns=[]}insert(e,t,s){this.name=`${e} ${t}`,this.order=++this.order;let r=this;const n=ct(t),a=[],o=[];for(let c=0,l=n.length;c<l;c++){const d=n[c];if(Object.keys(r.children).includes(d)){o.push(...r.patterns),r=r.children[d];const w=pe(d);w&&a.push(w[1]);continue}r.children[d]=new De;const f=pe(d);f&&(r.patterns.push(f),o.push(...r.patterns),a.push(f[1])),o.push(...r.patterns),r=r.children[d]}r.methods.length||(r.methods=[]);const h={},i={handler:s,possibleKeys:a.filter((c,l,d)=>d.indexOf(c)===l),name:this.name,score:this.order};return h[e]=i,r.methods.push(h),r}gHSets(e,t,s,r){const n=[];for(let a=0,o=e.methods.length;a<o;a++){const h=e.methods[a],i=h[t]||h[g],c={};i!==void 0&&(i.params={},i.possibleKeys.forEach(l=>{const d=c[i.name];i.params[l]=r[l]&&!d?r[l]:s[l]??r[l],c[i.name]=!0}),n.push(i))}return n}search(e,t){const s=[];this.params={};let n=[this];const a=Se(t);for(let h=0,i=a.length;h<i;h++){const c=a[h],l=h===i-1,d=[];for(let f=0,w=n.length;f<w;f++){const y=n[f],E=y.children[c];E&&(E.params=y.params,l===!0?(E.children["*"]&&s.push(...this.gHSets(E.children["*"],e,y.params,{})),s.push(...this.gHSets(E,e,y.params,{}))):d.push(E));for(let R=0,S=y.patterns.length;R<S;R++){const C=y.patterns[R],k={...y.params};if(C==="*"){const re=y.children["*"];re&&(s.push(...this.gHSets(re,e,y.params,{})),d.push(re));continue}if(c==="")continue;const[G,K,M]=C,O=y.children[G],ue=a.slice(h).join("/");if(M instanceof RegExp&&M.test(ue)){k[K]=ue,s.push(...this.gHSets(O,e,y.params,k));continue}(M===!0||M instanceof RegExp&&M.test(c))&&typeof G=="string"&&(k[K]=c,l===!0?(s.push(...this.gHSets(O,e,k,y.params)),O.children["*"]&&s.push(...this.gHSets(O.children["*"],e,k,y.params))):(O.params=k,d.push(O)))}}n=d}return[s.sort((h,i)=>h.score-i.score).map(({handler:h,params:i})=>[h,i])]}},$t=class{constructor(){this.name="TrieRouter",this.node=new De}add(e,t,s){const r=Pe(t);if(r){for(const n of r)this.node.insert(e,n,s);return}this.node.insert(e,t,s)}match(e,t){return this.node.search(e,t)}},Be=class extends Rt{constructor(e={}){super(e),this.router=e.router??new Tt({routers:[new At,new $t]})}},me=new TextEncoder,Ct=e=>new ReadableStream({async start(s){var c;const r=e instanceof Promise?await e:await e.toString(),n=typeof r=="object"?r:{},a=await Z(r,I.BeforeStream,!0,n);s.enqueue(me.encode(a));let o=0;const h=[],i=l=>{h.push(l.catch(d=>(console.trace(d),"")).then(async d=>{var f;d=await Z(d,I.BeforeStream,!0,n),(f=d.callbacks)==null||f.map(w=>w({phase:I.Stream,context:n})).filter(Boolean).forEach(i),o++,s.enqueue(me.encode(d))}))};for((c=a.callbacks)==null||c.map(l=>l({phase:I.Stream,context:n})).filter(Boolean).forEach(i);o!==h.length;)await Promise.all(h);s.close()}}),bt=Ke(null),Ht=(e,t,s,r)=>(n,a)=>{const o=typeof(r==null?void 0:r.docType)=="string"?r.docType:(r==null?void 0:r.docType)===!1?"":"<!DOCTYPE html>",h=s?s({children:n,Layout:t,...a}):n,i=je`${b(o)}${Qe(bt.Provider,{value:e},h)}`;return r!=null&&r.stream?e.body(Ct(i),{headers:r.stream===!0?{"Transfer-Encoding":"chunked","Content-Type":"text/html; charset=UTF-8"}:r.stream}):e.html(i)},Ot=(e,t)=>function(r,n){const a=r.getLayout()??Ye;return e&&r.setLayout(o=>e({...o,Layout:a})),r.setRenderer(Ht(r,a,e,t)),n()};const Ft=Ot(({children:e,title:t})=>D("html",{children:[D("head",{children:[D("link",{href:"/static/style.css",rel:"stylesheet"}),D("title",{children:t})]}),D("body",{children:e})]}),{docType:!0}),de=new Be;de.get("*",Ft);de.get("/",e=>e.render(D("h1",{children:"Hello!"})));var Me=()=>async e=>{const s=await e.env.ASSETS.fetch(e.req.raw);return s.status===404?e.notFound():s};const te=new Be;te.get("/favicon.ico",Me());te.get("/static/*",Me());const Lt=Object.assign({"/src/index.tsx":de});let Ne=!1;for(const[,e]of Object.entries(Lt))e&&(te.route("/",e),te.notFound(e.notFoundHandler),Ne=!0);if(!Ne)throw new Error("Can't import modules from ['/src/index.tsx','/app/server.ts']");export{te as default};
